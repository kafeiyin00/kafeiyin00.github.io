---
layout: post
title: stm32 base usage
date: 2020-08-24
Author: jianping
categories: 
tags: [hardware]
comments: false
---

# Contents
{:.no_toc}
* Will be replaced with the ToC, excluding the "Contents" header
{:toc}



## GPIO Write

cubeMX automatic generate initialization function of GPIo, then we use HAL_GPIO_WritePin

```cpp

HAL_GPIO_WritePin(GPIOF,LED0_Pin,GPIO_PIN_SET);

```

## GPIO Read

use HAL_GPIO_WritePin 

```cpp

GPIO_PinState pin_state = HAL_GPIO_ReadPin(GPIOE,KEY0_Pin);

```

## NVIC of GPIO

set priority of NVIC in cubeMX, then write weak funcuion: HAL_GPIO_EXTI_Callback

```cpp

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
  if(GPIO_Pin == GPIO_PIN_3)
	{
		if(KEY1_SET == 0 ){
			//...
		}else{
			//...
		}
	}
}

```

## General TIM (TIM 2-5)

clock source of TIM2-5 is APB1, 84MHz
![](https://pic.downk.cc/item/5f430f03160a154a67bc1ec8.jpg)

if we want to set TIM2 to 1Hz, then

|APB1:|clock source|84,000,000|
|PSC:|/(84-1)|1,000,000|
|COUNTER:|/(1,000,000-1)|1|

## Accurate delay using TIM

__HAL_TIM_SetCounter

__HAL_TIM_GetCounter

HAL_TIM_Base_Start

## NVIC of TIM

config NVIC of TIM2 in cubemx, rewrite weak function, for example: HAL_TIM_PeriodElapsedCallback

```cpp

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
  if(htim->Instance == TIM2)
	{
		//...
	}
}

```

do not forget to use HAL_TIM_Base_Start_IT, which stats the NVIC

```cpp

    HAL_TIM_Base_Start_IT(&htim2); 

```

## UART

```cpp

    HAL_UART_Transmit(&huart1, (uint8_t *)&ch, 1, 0xffff);
```


## UART with DMA
